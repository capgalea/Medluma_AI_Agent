%%{init: {'theme':'base', 'themeVariables': { 'background':'#ffffff', 'primaryColor':'#ffffff', 'primaryBorderColor':'#333', 'lineColor':'#333', 'secondaryColor':'#ffffff', 'tertiaryColor':'#ffffff', 'clusterBkg':'#ffffff', 'clusterBorder':'#616161', 'defaultLinkColor':'#333', 'titleColor':'#333', 'edgeLabelBackground':'#ffffff'}}}%%

flowchart TD
    Start(["ğŸ¯ User Query<br/>Enter Disease/Condition"])
    
    Start --> Coordinator["ğŸ›ï¸ Coordinator Agent<br/>Get User Preference"]
    
    Coordinator --> Choice{"Output Format?"}
    
    Choice -->|Comprehensive| Research["ğŸ”¬ Research Phase"]
    Choice -->|Simple| Research
    
    subgraph Research ["ğŸ“š Data Collection"]
        direction TB
        BioResearch["ğŸ§¬ Bio Researcher<br/>â€¢ Clinical Trials<br/>â€¢ Mutations<br/>â€¢ Research Papers"]
        NewsResearch["ğŸ“° Health Researcher<br/>â€¢ Latest News<br/>â€¢ Breakthroughs<br/>â€¢ Applications"]
        
        BioResearch & NewsResearch --> Aggregate["ğŸ”„ Aggregator<br/>Create Executive Summary"]
    end
    
    Research --> Writer["âœï¸ Initial Writer<br/>Draft Article"]
    
    Writer --> QualityLoop
    
    subgraph QualityLoop ["ğŸ” Quality Assurance Loop"]
        direction TB
        Critic{"ğŸ“ Critic Agent<br/>Review Quality"}
        Critic -->|Needs Work| Refiner["âœ¨ Refiner Agent<br/>Improve Article"]
        Refiner --> Critic
        Critic -->|Approved âœ“| Done["âœ… Quality Approved"]
    end
    
    QualityLoop --> Format["ğŸ“Š Final Output Agent"]
    
    Format --> CompCheck{"User Preference?"}
    
    CompCheck -->|Comprehensive| FullReport["ğŸ“‹ Full Report<br/>â€¢ Executive Summary<br/>â€¢ Article<br/>â€¢ Key Developments<br/>â€¢ References"]
    CompCheck -->|Simple| SimpleReport["ğŸ“„ Simple Article<br/>Concise Summary Only"]
    
    FullReport --> End([" ğŸ‰ Delivered to User"])
    SimpleReport --> End
    
    style Start fill:#e1f5ff,stroke:#0288d1,stroke-width:3px
    style Coordinator fill:#fff3e0,stroke:#ff9800,stroke-width:2px
    style BioResearch fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px
    style NewsResearch fill:#e8f5e9,stroke:#4caf50,stroke-width:2px
    style Aggregate fill:#fff9c4,stroke:#fbc02d,stroke-width:2px
    style Writer fill:#e0f2f1,stroke:#009688,stroke-width:2px
    style Critic fill:#fce4ec,stroke:#e91e63,stroke-width:2px
    style Refiner fill:#e3f2fd,stroke:#2196f3,stroke-width:2px
    style Done fill:#c8e6c9,stroke:#4caf50,stroke-width:3px
    style Format fill:#f1f8e9,stroke:#8bc34a,stroke-width:2px
    style FullReport fill:#e8eaf6,stroke:#3f51b5,stroke-width:2px
    style SimpleReport fill:#e8eaf6,stroke:#3f51b5,stroke-width:2px
    style End fill:#c8e6c9,stroke:#4caf50,stroke-width:3px
    style Choice fill:#fff3e0,stroke:#ff9800,stroke-width:2px
    style CompCheck fill:#fff3e0,stroke:#ff9800,stroke-width:2px
    
    classDef researchBox fill:#ffffff,stroke:#616161,stroke-width:2px,stroke-dasharray: 5 5
    classDef qualityBox fill:#ffffff,stroke:#616161,stroke-width:2px,stroke-dasharray: 5 5
    
    class Research researchBox
    class QualityLoop qualityBox
